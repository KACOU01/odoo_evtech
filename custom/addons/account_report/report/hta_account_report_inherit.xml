<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="report_account_inherit">
        <t t-call="web.html_container">
            <t t-call="web.internal_layout">
                <t t-foreach="docs" t-as="o">
                    <div class="header">
                        <div class="row" style="margin-bottom:150px">

                        </div>
                    </div>

                    <div class="page" style="font-size:13px; margin-top:150px">
                        <div class="row mb32" style="font-family: Times New Roman;" width="100%">

                            <div class="col-6" style="font-size:1em; font-weight:bold;margin-right:0px">


                                <div class="text-left mt-3 "
                                     style="font-family: Times New Roman; color:black; font-size:1em; font-weight:bold;">
                                    <br/>
                                    <br/>
                                    Notre référence :

                                    <span t-if="o.move_type == 'out_invoice' and o.state == 'posted'"></span>

                                    <span t-if="o.move_type == 'out_invoice' and o.state == 'draft'"></span>

                                    <span t-if="o.move_type == 'out_invoice' and o.state == 'cancel'"></span>

                                    <span t-if="o.name != '/'" t-field="o.name"/>

                                </div>

                                <div t-if="o.invoice_date" name="invoice_date" class="text-left">

                                    <t t-if="o.move_type == 'out_invoice'">Date de la facture :</t>

                                    <t t-elif="o.move_type == 'out_receipt'">
                                        <strong>Date de réception :</strong>
                                    </t>

                                    <t t-else="">
                                        <strong>Date:</strong>
                                    </t>

                                    <span t-field="o.invoice_date" t-options='{"widget": "date", "date_format": "DD/MM/YYYY"}'/>

                                </div>
                                <div t-if="o.invoice_filter_type_domain == 'sale'" name="invoice_sale" class="text-left">

                                    <t t-if="o.invoice_filter_type_domain == 'sale'">Devis : <span t-field="o.invoice_origin"/></t>

                                </div>

                            </div>

                            <div class="col-6 ml-6" style="font-size:1em; font-weight:bold;margin-right:10px">
                                <p style="font-size:1em; font-weight:bold; font-family: Times New Roman; color:black;">
                                    <br/>
                                    <br/>
                                    <span t-field="o.partner_id.display_name"/>
                                    <br/>
                                    <t t-if="o.partner_id.street">
                                        <span t-field="o.partner_id.street"/>
                                        <br/>
                                    </t>

                                    <t t-if="o.partner_id.country_id">
                                        <span t-field="o.partner_id.country_id"/>
                                        <br/>
                                    </t>

                                    <t t-if="o.partner_id.phone">
                                        <span t-field="o.partner_id.phone"/>
                                        <br/>
                                    </t>

                                    <t t-if="o.partner_id.email">
                                        <span t-field="o.partner_id.email"/>
                                    </t>


                                </p>


                            </div>

                        </div>


                        <div id="informations" class="text-center mb-5"
                             style="font-family: Times New Roman; color:#4ab0f6; font-weight:bold; font-size:0.9em">


                            <div t-if="o.partner_id.ref" name="customer_code">


                                <strong>Code Client:</strong>

                                <p class="m-0" t-field="o.partner_id.ref"/>

                            </div>


                        </div>


                        <t t-set="display_discount" t-value="any(l.discount for l in o.invoice_line_ids)"/>

                        <t t-set="amount_taxed" t-value='0'/>

                        <t t-set="amount_taxed_airsi" t-value='0'/>

                        <table class="table table-sm o_main_table mt-5" name="invoice_line_table"
                               style="font-family:Times New Roman;border">

                            <thead >

                                <tr>
                                    <th name="th_image">
                                        
                                    </th>
                                    <th name="th_description">
                                        <span>PRODUIT</span>
                                    </th>
                                    <th name="th_description">
                                        <span>NUMERO SERIE</span>
                                    </th>
                                    <th name="th_quantity" class="text-center">
                                        <span>QUANTITE</span>
                                    </th>
                                    <th name="th_pricarton"
                                        t-attf-class="{{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span>PRIX UNITAIRE</span>
                                    </th>


                                    <th name="th_taxes"
                                        t-attf-class="text-center {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span>TVA</span>
                                    </th>
                                    <th name="th_discount"
                                        t-attf-class="text-center {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span>REMISE</span>
                                    </th>
                                    <th name="th_subtotal" class="text-center">
                                        <!--<span groups="account.group_show_line_subtotals_tax_excluded">MONTANT</span>-->
                                        <span>MONTANT</span>
                                    </th>
                                </tr>

                            </thead>

                            <tbody class="invoice_tbody">
                                <t t-set="current_subtotal" t-value="0"/>
                                <t t-set="lines"
                                   t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                                <t t-foreach="lines" t-as="line">

                                    <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal"
                                       groups="account.group_show_line_subtotals_tax_excluded"/>

                                    <t t-set="current_subtotal" t-value="current_subtotal + line.price_total"
                                       groups="account.group_show_line_subtotals_tax_included"/>
                                    <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">

                                        <t t-if="not line.display_type" name="account_invoice_line_accountable">
                                            <td>
                                                <img t-if="line.product_id.image_1920" t-att-src="'data:image/png;base64,' + line.product_id.image_1920.decode('utf-8')" style="max-width: 50px; max-height: 50px;" />
                                            </td>
                                            <td>
                                                <span t-field="line.name"/>
                                            </td>
                                            <td class="text-right">
                                                <span t-field="line.lot_number"/>
                                            </td>
                                            <td class="text-center">
                                                <span t-field="line.quantity"
                                                      t-options='{"widget": "float", "precision": 0}'/>

                                            </td>

                                            <td t-attf-class="{{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}"
                                                class="text-center">
                                                <span class="text-nowrap" t-field="line.price_unit"
                                                      t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                            </td>
                                            <td t-attf-class="text-center {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">

                                                <span t-esc="', '.join(map(lambda x: (x.description or x.name), line.tax_ids))"
                                                      id="line_tax_ids"/>

                                            </td>
                                            <t t-if="line.discount > 0">
                                                <td class="text-right">
                                                    <span t-field="line.discount"/>%
                                                </td>
                                            </t>
                                            <t t-else="">
                                                <td class="text-center">
                                                    --
                                                </td>

                                            </t>


                                            <td class="text-right o_price_total">

                                                <!--<span class="text-nowrap" t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>-->

                                                <span class="text-nowrap" t-field="line.price_subtotal"
                                                      t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                            </td>

                                        </t>

                                        <t t-if="line.display_type == 'line_section'">

                                            <td colspan="99">

                                                <span t-field="line.name" t-options="{'widget': 'text'}"/>

                                            </td>

                                            <t t-set="current_section" t-value="line"/>

                                            <t t-set="current_subtotal" t-value="0"/>

                                        </t>

                                        <t t-if="line.display_type == 'line_note'">

                                            <td colspan="99">

                                                <span t-field="line.name" t-options="{'widget': 'text'}"/>

                                            </td>

                                        </t>

                                    </tr>

                                    <t t-if="current_section and (line_last or lines[line_index+1].display_type == 'line_section')">

                                        <tr class="is-subtotal text-right">

                                            <td colspan="99">

                                                <strong class="mr16">SOUS TOTAL</strong>

                                                <span t-esc="current_subtotal"
                                                      t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>

                                            </td>

                                        </tr>

                                    </t>

                                </t>

                            </tbody>

                        </table>

                        <div class="clearfix" style="font-family: Times New Roman;font-size:0.9em">

                            <div id="total" class="row">

                                <div t-attf-class="#{'col-6' if report_type != 'html' else 'col-sm-7 col-md-6'} ml-auto">

                                    <table width="100%" class="table table-sm o_main_table" style="border:0;">

                                        <t>

                                            <tr>

                                                <td class="text-right" width="55%" style="border: 0;">
                                                    <strong>
                                                        <span>TOTAL HT</span>
                                                    </strong>
                                                </td>


                                                <td class="text-right" width="40%" style="border: 0;">
                                                    <strong>
                                                        <span t-field="o.amount_untaxed"
                                                              t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                                    </strong>
                                                </td>

                                            </tr>

                                        </t>
                                        <t t-if="o.amount_discount > 0">
                                            <tr>
                                                <td class="text-right" width="55%" style="border: 0;">
                                                    <strong>
                                                        dont
                                                        <span>TOTAL REMISE</span>
                                                    </strong>

                                                </td>
                                                <td class="text-right" width="40%" style="border: 0;">
                                                    <strong>
                                                        <span t-field="o.amount_discount"
                                                              t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                                    </strong>
                                                </td>
                                            </tr>
                                        </t>

                                        <t t-if="o.amount_tax">
                                            <tr>
                                                <td class="text-right" width="55%" style="border: 0;">
                                                    <strong>
                                                        <span>TOTAL TVA</span>
                                                    </strong>
                                                </td>
                                                <td class="text-right" width="40%" style="border: 0;">
                                                    <strong>
                                                        <span t-field="o.amount_tax"
                                                              t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                                    </strong>
                                                </td>
                                            </tr>

                                            <tr>


                                            </tr>

                                        </t>

                                        <tr class="bg-light" style="border: 0;">

                                            <td class="text-right bg-light" style="border: 0;" width="55%">
                                                <strong>
                                                    <span>TOTAL TTC</span>
                                                </strong>
                                            </td>


                                            <td class="text-right bg-light" style="border: 0;" width="40%">
                                                <strong>
                                                    <span t-field="o.amount_total"
                                                          t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                                </strong>
                                            </td>

                                        </tr>

                                    </table>

                                </div>

                            </div>

                        </div>

                        <p class="text-uppercase mt-3"
                           style="font-family: Times New Roman;font-size:0.9em;font-weight : bold">

                            arrêté la présente facture à la somme de :
                            <br/>
                            <span t-field="o.amount_to_word"/>
                            <span class="text-uppercase" t-field="o.currency_id.symbol"/>

                            <br/>
                            <div t-if="o.invoice_payment_term_id">

                                <p>
                                    <strong>
                                        Conditions de règlement :
                                        <span t-field="o.invoice_payment_term_id"/>
                                    </strong>
                                </p>


                            </div>

                        </p>

                        <div class="row mt-3" style="font-family: Times New Roman;font-size:0.8em">


                        </div>


                    </div>
                </t>
            </t>
        </t>

    </template>


</odoo>